@using Domain.Todos.ValueObjects
@using Client.Components

<MudTable Items="Items" Hover Elevation="0" AnchorOrigin="Origin.BottomLeft" Loading="@IsLoading">
    <ToolBarContent>
        <MudSpacer />
        <form class="d-flex justify-end" @onsubmit="@DoSearch">
            <MudTextField @bind-Value="@SearchText" Placeholder="検索" Adornment="Adornment.Start"
                Margin="Margin.Dense" AdornmentIcon="@Icons.Material.Filled.Search"
                Class="mt-0 mb-4" Style="width: 300px;" Clearable />
        </form>
    </ToolBarContent>

    <ColGroup>
        <col style="width: 100%;" />
        <col style="width: 150px;" />
        <col style="width: 150px;" />
        <col style="width: 150px;"/>
        <col style="width: 50px;"/>
    </ColGroup>

    <HeaderContent>
        <MudTh>タイトル</MudTh>
        <MudTh>開始日</MudTh>
        <MudTh>終了日</MudTh>
        <MudTh style="text-align: center">状態</MudTh>
        <MudTh style="text-align: center"></MudTh>
    </HeaderContent>

    <RowTemplate>
        <MudTd DataLabel="タイトル"
            Style="@((IsOwnedByUser(context) ? "cursor: pointer" : null))"
            @onclick="@(() => EditItem(context))">
            <MudLink Typo="Typo.body2" Disabled="@(!IsOwnedByUser(context))">
                @context.Title
            </MudLink>
        </MudTd>
        <MudTd DataLabel="開始日">@(context.StartDate?.ToShortDateString() ?? "-")</MudTd>
        <MudTd DataLabel="終了日">@(context.EndDate?.ToShortDateString() ?? "-")</MudTd>
        <MudTd DataLabel="状態" style="text-align: center">
            <MudMenu Dense>
                <ActivatorContent>
                    <MudChip Icon="@(GetTodoIcon(context))" Color="@(GetTodoChipColor(context))">
                        @context.State.DisplayValue
                    </MudChip>
                </ActivatorContent>
                <ChildContent>
                    @foreach (var state in TodoState.Status)
                    {
                        <MenuButton
                            OnClick="@(() => ChangeState(context, state))"
                            Disabled="@(IsDisabledChangeState(context, state))">
                            @(state.DisplayValue)に切り替え
                        </MenuButton>
                    }
                </ChildContent>
            </MudMenu>
        </MudTd>
        <MudTd DataLabel="操作" style="text-align: center">
            <MudMenu Dense Icon="@Icons.Material.Filled.MoreVert" Disabled="@(!IsOwnedByUser(context))">
                <MenuButton OnClick="@(() => EditItem(context))">
                    編集
                </MenuButton>
                <MenuButton OnClick="@(() => DeleteItem(context))">
                    削除
                </MenuButton>
            </MudMenu>
        </MudTd>
    </RowTemplate>
</MudTable>

<MudMessageBox @ref="DeleteConfirm" Title="Todoの削除" CancelText="キャンセル">
    <MessageContent>
        本当にこのTodoを削除しますか？
    </MessageContent>
    <YesButton>
        <MudButton Variant="Variant.Filled" Color="Color.Error" StartIcon="@Icons.Material.Filled.DeleteForever">
            削除
        </MudButton>
    </YesButton>
</MudMessageBox>